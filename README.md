# bootlogn2016
bootstrapped doubly truncated lognormal distribution

The Bootstrapped Lognormal Distribution (This appendix is derived and updated from Wilson 1987a). Although the NESS and Sanders-Hurlbert rarefaction programs are based on well known algorithms, the bootstrapped lognormal estimator of species richness requires a detailed description. This method joins the techniques of bootstrap estimators (Efron 1979; Efron and Gong 1982) with that of fitting the lognormal distribution to species abundance data (Preston 1948 1962; Pielou 1975), thereby estimating the total assemblage structure of a taxocene.  The lognormal distribution can be fitted in a variety of ways, although the one chosen here uses the equations for a doubly truncated normal distribution for which equations are provided by Cohen (1950). Real species abundance distributions are truncated at the lower end because not enough samples were taken to collect all species in an assemblage. They are truncated at the upper end because a discrete abundance distribution is being estimated by a theoretical continuous distribution: an upper tail of abundances have less than one species in the standard lognormal distribution. The algorithm and original program for the doubly truncated lognormal was written by George Sugihara (SIO, personal communication), who wrote his Fortran 77 program to calculate independent estimates for entropy (H’) and evenness (J’) indices of an assemblage. I converted his program to Pascal (Borland Turbo Pascal version 4), generalized it so that it could handle different log bases, and added a bootstrapping algorithm that would calculate Ŝ, variance, and standard deviation. The current version, Bootln2016, is slightly updated from the 1992 version to compile using Free Pascal in Linux. Windows (DOS command line) and Linux executables are available from the author on request. The source is posted on github. 
Lognormal distributions as applied to assemblage structure from real species abundance data often have the property that the modal abundance distribution coincides with the upper tail of the species distribution. Distributions having this property are termed “canonical”. These canonical lognormal distributions have the further property that they can be used to estimate the exponent z of the well known species-area relationship. May (1975) has suggested that this canonical property is merely a general property of lognormal distributions, although recently Sugihara (1980; see also Harmsen 1983) has argued that it is a result of an underlying niche partitioning process in natural assemblages. These results have been further extended to suggest that canonical distributions will characterize assemblages that are under assembly or under stress, while equilibrium assemblages will be less canonical and will have a lower variance due to evolutionary accommodation (Harmsen 1983).  These results suggest uses for the lognormal distribution that apply to theoretical ecology. The pragmatic use of the lognormal distribution, however, stems from the observation that assemblages will be made up of a few species that are extremely abundant, a few that are vanishingly rare, and a majority that range of  intermediate abundances. Many species will have minimum abundances beyond which they cannot maintain sufficient populations for continued reproduction: real assemblages, therefore, should be lognormal in form. This pattern of abundances may effectively be estimated by a lognormal distribution, which tends to standardize the scale between the most and least abundant species as well as indicate the position of the central majority of the species. Another advantage for using the lognormal distribution for studying assemblage structure is that it uses all of the abundance data and displays it in a useful form, rather than distilling it down to a single value, such as Hill numbers (Chao et al 2014). An associated lognormal parameter is the estimation of the total species in the theoretical distribution, S\*, calculated by integrating the area under the normal curve. Knowing this number is highly desirable because not only will it tell an investigator how well he has sampled an assemblage, but it will also permit the comparison of the complete species richnesses of several assemblages. One cannot help look at a standard rarefaction curve without trying to extrapolate it in the mind’s eye to its asymptotic maximum. Such a procedure would be objectionable (Fager 1972; Tipper 1979), while the truncated lognormal estimate (Cohen 1950) uses manageable assumptions, some of which can be tested statistically. For example, one can use a simple Chi Square test to measure the departure of the theoretical estimated distribution from the original. This method is used in the program to reject data sets that lack sufficient data, or have a poor fit to the normal distribution. In addition, analytical estimates for the mean and variance can be calculated. No analytical estimate for S\* exists for the standard lognormal (Pielou 1975; Colwell and Coddington 1994). Bulmer (1974) applied a Poisson lognormal to species abundance data with some success, although the Poisson and the standard lognormal distributions give different S\* estimates (Pielou 1975), perhaps because the former has an upper bound of infinity. Because the doubly truncated lognormal is the simpler distribution, I have chosen it for use in a bootstrap estimate of S\*, Ŝ. 
 Bootstrapping the lognormal distribution provides a solution to calculating an estimate of variance. Bootstrapping simulates sampling variability by performing a Monte Carlo resampling of the original data with replacement to create new synthetic data sets of the same size, but with a random variation (Efron 1979; Efron and Gong 1982). In this application, we wish to see how well the lognormal distribution will estimate S\* under further sampling. Although actual resampling is often not possible, we can assume that we have taken enough samples to characterize the distribution at the current sample size. Resampling is done by randomly picking individuals from the original distribution and sorting them by species. Therefore, each species has a probability of being picked proportional to its relative abundance in the actual pooled sample. However, because each individual is picked independently and with replacement, the abundance of each species varies randomly. Individuals are picked until a new data set is created that has exactly the same number of species and individuals but with varying abundances of each species. If many data sets are taken iteratively, the mean abundance of each species will approach the observed abundance. The individual synthetic data sets are then fitted with the lognormal distribution and the value for S\* is estimated for each. If this is done many times, the mean of the S\* estimates is the bootstrap estimator of the theoretical total species in an assemblage, Ŝ, with its associated variance, Var(Ŝ).
 This program, BOOTLN92 (the current version is bootlogn2016 with minor changes from the 1992 version compiled with the Linux based cross compiler, Free Pascal, with Borland compatibility mode on) does show the desirable qualities of estimating var(Ŝ) to be high for small data sets and small for large data sets. Large data sets with a low var(Ŝ) were found to be relatively invariant for differing log bases. Log base 2 has been retained as the distribution of choice because it divides an abundance distribution more finely. Because the algorithm splits boundary values between abundance bins, differences between bins in the data are smoothed for log base 2 where integer boundary values are most frequent (personal communication, Paul Smith, Southwest Fisheries Center, La Jolla California). Natural logs (Caswell and Weinberg 1986) or log base 10 (Pielou 1975) lack this smoothing effect. A further desirable property is the algorithm’s ability to qualitatively estimate differences in species richness observed in samples displayed in rarefaction curves: if one curve appears to have a higher asymptote than another, their Ŝ will agree on this difference. 
Colwell and Coddington (1994) asserted “... fitting the continuous lognormal to sparse samples … is problematic for a number of reasons, and should probably be avoided.” Those reasons (Colwell and Coddington 1994) include: lack of an estimate of variance of the area under the curve, fitting a continuous function to discrete data, choice of the interval affects the result, splitting singletons and doubletons between octaves causing the modal octave to be the second octave. The use of the doubly truncated lognormal alleviates many of these problems, such as fitting the discrete data and an nonparametric value for the variance of the area is provided by the bootstrap algorithm. Because the 0.5-1 individual octave is underestimated,  an unknown number of species are unobserved in this octave, Sugihara’s algorithm dropped this octave entirely, thus omitting half of the singletons.  Bootln2016 will report that the sample distribution (for log base 2) is smaller than the observed distribution, and will give both distributions in the initial output. As a result, the modal octave for sparse data is often either the first (1-2) or second (2-4), depending on the coverage of the initial sampling. Certainly the size of the interval affects the results, but for sparse assemblages, log base 2 is the best choice because it gives a higher chance of fitting the lognormal distribution. In short, the methods that have been used here have not been explored sufficiently in the literature, despite that they provide useful projections of the total species in an assemblage.  Another useful attribute of this distribution is that the theoretical distribution also will give the minimum sample size of individuals to obtain the estimated number of species. This result is directly translatable into estimating the number of standard quantitative samples needed to capture all species in a local assemblage as was done here. 
Comparison to another index, CHAO1. The CHAO1 estimator   (Chao 1984; Colwell and Coddingon 1994) in BDPRO (McAleece et al. 1997) and EstimateS (Colwell 2013) was used on these data but consistently found the lower bound of the bootstrapped results (Table 1). Chao (1984) indicated that the index should find the lower bounds of the rarest species, which coincides with the experimental results. Nonrandom clumped distributions, common in deep-sea samples. may also impact the frequency of singletons and doubletons, on which the index depends. Because the lognormal estimator uses the species abundance values directly, it should be less affected by contagious distributions, especially if the data are pooled from multiple samples as done here. 


References

Bulmer MG (1974) On fitting the Poisson lognormal distribution to species-abundance data  Biometrics 30:101-110  

Caswell H, and Weinberg JR (1986) Sample size and sensitivity in the detection of community impact  In: IEEE Oceans Conference Proceedings, pp 1040-1045

Chao A (1984) Nonparametric Estimation of the Number of Classes in a Population Scandinavian Journal of Statistics 11:265-270

Chao A, Chiu C-H, Jost L (2014) Unifying species diversity, phylogenetic diversity, functional diversity, and related similarity and differentiation measures through Hill numbers Annual Review of Ecology, Evolution, and Systematics 45:297-324 doi:10.1146/annurev-ecolsys-120213-091540

Cohen AC, Jr (1950) Estimating the mean and variance of normal populations from singly truncated and doubly truncated samples Annals of Mathematics and Statistics 21:557-569  

Colwell RK (2013) EstimateS: Statistical estimation of species richness and shared species from samples. Version 9. User's Guide and application published at: http://purl.oclc.org/estimates, accessed 3 Nov 2016. 

Colwell RK, Coddington JA (1994) Estimating terrestrial biodiversity through extrapolation Philosophical Transactions of the Royal Society of London B: Biological Sciences 345:101-118

Efron B (1979) Bootstrap methods: another look at the jackknife The Annals of Statistics 7:1-26 

Efron B, Gong G (1983) A leisurely look at the bootstrap, the jackknife, and cross-validation The American Statistician 37:36-48 doi:10.1080/00031305.1983.10483087

Fager EW (1972) Diversity: a sampling study  American Naturalist 106:293-310  

Grassle JF, Smith W (1976) A similarity measure sensitive to the contribution of rare species and its use in investigation of variation of marine benthic communities  Oecologia 25:13-22

Harmsen R (1983) Abundance distribution and the evolution of community structure  Evolutionary Theory 6:283-292

Hurlbert SH (1971) The nonconcept of species diversity: a critique and alternative parameters  Ecology 52:577-586  

McAleece N, Gage JD, Lambshead PJD, Paterson GLJ (1997) BioDiversity Professional statistics analysis software. Scottish Association for Marine Science and the Natural History Museum London, London

Pielou EC (1975) Ecological diversity  New York, NY: Wiley, 165 pp  

Preston FW (1962) The canonical distribution of commonness and rarity: part I Ecology 43:185-215 doi:10.2307/1931976

Preston FW (1962) The canonical distribution of commonness and rarity: Part II Ecology 43:410-432 doi:10.2307/1933371

Sanders HL (1968) Marine benthic diversity: a comparative study  American Naturalist 102:243-282  

Smith W, Grassle JF (1977) Sampling properties of a family of diversity measures  Biometrics 33:283-292  

Sugihara G (1980) Minimal community structure: an explanationof species abundance patternsAmerican Naturalist 116:770-787

Tipper JC (1979) Rarefaction and rarefiction - the use and abuse of a method in paleoecology  Paleobiology 5:423-434

Wilson GDF (1987) Crustacean communities of the manganese nodule province. Scripps Institution of Oceanography, La Jolla, California, USA. doi:10.13140/RG.2.1.4645.0729
